<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>LeetCode 20. Valid Parentheses 完整教學版</title>
    <style>
        :root {
            --primary: #2563eb;
            --code-bg: #1e293b;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
        }
        body { font-family: 'Inter', -apple-system, sans-serif; background: #f1f5f9; color: #1e293b; padding: 20px; line-height: 1.6; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        
        h1 { text-align: center; color: #0f172a; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #64748b; margin-bottom: 30px; }

        /* 區塊樣式 */
        .section { margin-bottom: 30px; padding: 20px; border-radius: 12px; background: #fff; border: 1px solid #e2e8f0; }
        h2 { color: var(--primary); border-left: 5px solid var(--primary); padding-left: 15px; margin-top: 0; font-size: 1.3rem; }

        /* 視覺化區域 */
        .viz-container { border: 2px solid #e2e8f0; border-radius: 12px; padding: 30px; margin: 20px 0; background: white; }
        .msg-box { min-height: 60px; padding: 15px; border-radius: 10px; margin-bottom: 25px; font-weight: 700; text-align: center; border: 2px solid var(--primary); display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
        .msg-error { background: #fef2f2; border-color: var(--danger); color: var(--danger); }
        .msg-success { background: #f0fdf4; border-color: var(--success); color: var(--success); }

        .simulation-grid { display: grid; grid-template-columns: 1.4fr 1fr; gap: 30px; }

        /* 堆疊視覺化 */
        .stack-column { display: flex; flex-direction: column; align-items: center; }
        .stack-pit { 
            width: 130px; height: 260px; 
            border: 5px solid #475569; border-top: none; 
            border-radius: 0 0 15px 15px;
            display: flex; flex-direction: column-reverse; 
            padding: 12px; background: #f8fafc; gap: 8px;
            position: relative;
        }
        .stack-item {
            height: 42px; background: var(--primary); color: white;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; border-radius: 6px; font-size: 1.3rem;
            animation: pushAnim 0.3s ease-out;
        }
        @keyframes pushAnim { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* 程式碼面板 */
        .code-panel { background: var(--code-bg); color: #e2e8f0; padding: 20px; border-radius: 12px; font-family: 'Fira Code', monospace; font-size: 13px; line-height: 1.6; overflow-x: auto; }
        .line { display: block; border-left: 4px solid transparent; padding-left: 15px; white-space: pre; }
        .active-line { background: #334155; border-left-color: #3b82f6; color: #fff; }

        /* 控制列 */
        .controls { text-align: center; margin-bottom: 25px; background: #f8fafc; padding: 20px; border-radius: 12px; }
        input { padding: 10px 15px; border: 2px solid #cbd5e1; border-radius: 8px; width: 250px; font-size: 1rem; font-family: monospace; }
        button { padding: 10px 25px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.2s; margin: 0 5px; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        button:disabled { background: #cbd5e1; cursor: not-allowed; transform: none; }

        .keyword { color: #c678dd; }
        .comment { color: #5c6370; font-style: italic; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #e2e8f0; padding: 12px; text-align: left; }
        th { background: #f8fafc; color: #64748b; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>Valid Parentheses</h1>
    <p class="subtitle">LeetCode #20 · 堆疊 (Stack) 資料結構應用</p>

    <div class="section">
        <h2>1. 題目敘述與範例</h2>
        <p>判斷字串中的括號開閉是否合法。每個左括號必須由相同類型的右括號閉合，且順序必須正確。</p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid #22c55e;">
                <strong>合法範例：</strong><br>
                s = "([{}])" → True<br>
                s = "()[]{}" → True
            </div>
            <div style="background: #fef2f2; padding: 15px; border-radius: 8px; border-left: 4px solid #ef4444;">
                <strong>不合法範例：</strong><br>
                s = "(]" → False (類型不符)<br>
                s = "([)]" → False (順序錯誤)
            </div>
        </div>
    </div>

    <div class="viz-container">
        <div class="controls">
            <label style="font-weight: 700;">輸入序列：</label>
            <input type="text" id="inputStr" value="([{}])">
            <button onclick="initSim()">初始化</button>
            <button id="nextBtn" onclick="stepSim()" disabled>下一步 (Step)</button>
        </div>

        <div id="msg" class="msg-box">請點擊初始化開始模擬</div>

        <div class="simulation-grid">
            <div class="code-panel">
<span class="line" id="l1"><span class="keyword">for</span> char <span class="keyword">in</span> s:</span>
<span class="line" id="l2">    <span class="keyword">if</span> char <span class="keyword">not in</span> pairs:</span>
<span class="line" id="l3">        stack.append(char) <span class="comment"># 左括號：Push 入棧</span></span>
<span class="line" id="l4">    <span class="keyword">else</span>:</span>
<span class="line" id="l5">        <span class="keyword">if not</span> stack:</span>
<span class="line" id="l6">            <span class="keyword">return False</span> <span class="comment"># 錯誤：右括號先到但棧空</span></span>
<span class="line" id="l7">        </span>
<span class="line" id="l8">        top = stack.pop() <span class="comment"># 取出棧頂左括號</span></span>
<span class="line" id="l9">        <span class="keyword">if</span> top != pairs[char]:</span>
<span class="line" id="l10">            <span class="keyword">return False</span> <span class="comment"># 錯誤：類型不匹配</span></span>
<span class="line" id="l11"></span>
<span class="line" id="l12"><span class="keyword">return</span> len(stack) == <span class="val">0</span> <span class="comment"># 最終棧必須清空</span></span>
            </div>

            <div class="stack-column">
                <div style="font-weight: 700; margin-bottom: 10px;">Stack (LIFO)</div>
                <div class="stack-pit" id="stack-v"></div>
                <div style="margin-top: 10px; color: #64748b; font-size: 0.8rem;">記憶體棧底</div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>3. 複雜度分析</h2>
        <table>
            <tr><th>分析項目</th><th>Big-O</th><th>理由說明</th></tr>
            <tr><td><strong>時間複雜度</strong></td><td>$O(n)$</td><td>只需掃描字串一次，每個字元的入棧/出棧皆為 $O(1)$ 操作。</td></tr>
            <tr><td><strong>空間複雜度</strong></td><td>$O(n)$</td><td>最壞情況下（如全為左括號），Stack 需要儲存所有 $n$ 個字元。</td></tr>
        </table>
    </div>
</div>

<script>
    let s = "";
    let idx = 0;
    let stack = [];
    const pairs = { ')': '(', ']': '[', '}': '{' };

    function initSim() {
        s = document.getElementById('inputStr').value;
        idx = 0;
        stack = [];
        document.getElementById('nextBtn').disabled = false;
        refreshUI(1, `開始掃描字串："${s}"`, "normal");
    }

    function stepSim() {
        if (idx >= s.length) {
            const result = stack.length === 0;
            refreshUI(12, result ? "✅ 掃描結束，棧已清空。結果：True" : "❌ 掃描結束，棧中仍有殘留。結果：False", result ? "success" : "error");
            document.getElementById('nextBtn').disabled = true;
            return;
        }

        let char = s[idx];
        if (!pairs[char]) {
            // 左括號
            stack.push(char);
            refreshUI(3, `讀取到左括號 "${char}"：執行 Push 到棧頂。`, "normal");
            idx++;
        } else {
            // 右括號詳細邏輯
            if (stack.length === 0) {
                refreshUI(6, `錯誤：讀取到 "${char}" 但棧已空，無人可匹配！`, "error");
                document.getElementById('nextBtn').disabled = true;
            } else {
                let top = stack[stack.length - 1]; // 先瞄一眼頂部
                if (top !== pairs[char]) {
                    refreshUI(10, `錯誤：棧頂是 "${top}"，與目前 "${char}" 類型不符！`, "error");
                    document.getElementById('nextBtn').disabled = true;
                } else {
                    stack.pop();
                    refreshUI(8, `匹配成功："${char}" 與棧頂 "${top}" 抵銷，執行 Pop。`, "success");
                    idx++;
                }
            }
        }
    }

    function refreshUI(line, msg, type) {
        const msgBox = document.getElementById('msg');
        msgBox.innerText = msg;
        msgBox.className = "msg-box " + (type === "error" ? "msg-error" : type === "success" ? "msg-success" : "");

        document.querySelectorAll('.line').forEach(l => l.classList.remove('active-line'));
        document.getElementById('l' + line).classList.add('active-line');

        const v = document.getElementById('stack-v');
        v.innerHTML = '';
        stack.forEach(c => {
            const item = document.createElement('div');
            item.className = 'stack-item';
            item.innerText = c;
            v.appendChild(item);
        });
    }
</script>

<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>