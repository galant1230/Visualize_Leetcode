<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>Number of 1 Bits Visualizer</title>
    <style>
        :root {
            --bg: #0d1117; --card: #161b22; --accent: #58a6ff;
            --pacific: #1f6feb; --atlantic: #238636; --energy: #d29922; --danger: #f85149;
            --editor-bg: #010409; --text: #c9d1d9; --dim: #8b949e;
            --keyword: #ff7b72; --hl: rgba(88, 166, 255, 0.2);
            --type: #79c0ff;
        }
        body { font-family: 'Consolas', 'Segoe UI', monospace; background: var(--bg); color: var(--text); margin: 0; padding: 15px; overflow: hidden; }
        
        .container { 
            max-width: 1850px; margin: auto; 
            display: grid; grid-template-columns: 350px 1fr 480px; gap: 20px; height: 95vh; 
        }

        .side-panel { background: var(--card); border: 1px solid #30363d; border-radius: 12px; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .info-card { background: #010409; border: 1px solid #30363d; padding: 14px; border-radius: 8px; font-size: 13px; line-height: 1.6; }
        .ex-box { background: #161b22; border-left: 3px solid var(--accent); padding: 10px; margin-top: 8px; font-size: 12px; color: var(--dim); }
        .tag { padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; background: rgba(88, 166, 255, 0.1); color: var(--accent); margin-right: 5px; }

        .main-panel { background: #010409; border: 1px solid #30363d; border-radius: 12px; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .viz-area { 
            background: var(--card); border-radius: 8px; padding: 40px 20px; border: 1px solid #333; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 300px;
        }

        .bit-row { display: flex; gap: 4px; margin: 10px 0; }
        .bit-cell {
            width: 35px; height: 45px; display: flex; align-items: center; justify-content: center;
            background: #21262d; border: 1px solid #30363d; border-radius: 4px; font-weight: bold; font-size: 18px;
            transition: all 0.3s ease;
        }
        .bit-cell.is-one { color: var(--accent); border-color: var(--accent); }
        .bit-cell.eliminating { background: var(--danger); border-color: #ff7b72; transform: scale(1.15); color: white; z-index: 5; }

        .editor { background: var(--editor-bg); border: 1px solid #30363d; border-radius: 12px; overflow: hidden; }
        .editor-header { 
            background: #161b22; padding: 10px 15px; display: flex; justify-content: space-between; 
            align-items: center; border-bottom: 1px solid #30363d; 
        }
        select { background: #0d1117; color: var(--accent); border: 1px solid #30363d; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; }

        .ln { white-space: pre; padding: 0 15px 0 65px; position: relative; line-height: 1.8; font-size: 14px; display: block; }
        .ln-num { position: absolute; left: 0; width: 50px; text-align: right; color: #484f58; padding-right: 15px; border-right: 1px solid #30363d; }
        .ln-active { background: var(--hl); border-left: 4px solid var(--accent); }
        .kw { color: var(--keyword); }
        .tp { color: var(--type); }

        .toolbar { grid-column: span 3; background: var(--card); padding: 12px 20px; border-radius: 12px; display: flex; justify-content: space-between; border: 1px solid #30363d; }
        .btn { background: var(--pacific); color: white; border: none; padding: 10px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        #math-display { font-family: 'Consolas', monospace; text-align: right; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 8px; margin-top: 20px; border: 1px dashed #444; }
    </style>
</head>
<body>

<div class="container">
    <div class="toolbar">
        <div style="font-weight:bold; color:var(--accent); font-size:20px;">191. Number of 1 Bits <span style="font-size:13px; color:var(--dim);">Brian Kernighan's Magic</span></div>
        <div style="display:flex; gap:12px;">
            <button class="btn" id="nextBtn" onclick="next()">ä¸‹ä¸€æ­¥ Step ğŸ§­</button>
            <button class="btn" style="background:#21262d" onclick="init()">é‡ç½® Reset</button>
        </div>
    </div>

    <div class="side-panel">
        <div class="info-card">
            <b style="color:var(--accent); font-size:15px;">ğŸ“– é¡Œç›®æè¿°</b><br>
            ç·¨å¯«ä¸€å€‹å‡½æ•¸ï¼Œè¼¸å…¥ä¸€å€‹ç„¡ç¬¦è™Ÿæ•´æ•¸ï¼Œå›å‚³å…¶äºŒé€²ä½è¡¨ç¤ºä¸­æ•¸å­—ç‚º '1' çš„å€‹æ•¸ï¼ˆHamming weightï¼‰ã€‚
        </div>

        <div class="info-card">
            <b style="color:var(--energy); font-size:15px;">ğŸ’¡ ç¯„ä¾‹è§£æ</b>
            <div class="ex-box">
                <b>Input:</b> 11 (äºŒé€²ä½ <code>1011</code>)<br>
                <b>Output:</b> 3
            </div>
        </div>

        <div class="info-card">
            <b style="color:var(--atlantic); font-size:15px;">ğŸ§  æ ¸å¿ƒæŠ€å·§ï¼šn & (n - 1)</b><br>
            ç•¶æˆ‘å€‘åŸ·è¡Œ <code>n & (n - 1)</code> æ™‚ï¼Œæœƒå°‡ <code>n</code> äºŒé€²ä½ä¸­æœ€å³é‚Šçš„é‚£å€‹ <code>1</code> è®Šæˆ <code>0</code>ã€‚<br><br>
            <b>å„ªå‹¢ï¼š</b>é‹ç®—æ¬¡æ•¸åªç­‰æ–¼ <code>1</code> çš„å€‹æ•¸ã€‚
        </div>

        <div class="info-card">
            <span class="tag">Time: O(1)</span> (æœ€å¤š 32 æ¬¡)
            <span class="tag">Space: O(1)</span>
        </div>
    </div>

    <div class="main-panel">
        <div class="viz-area">
            <div style="font-size:11px; color:var(--dim); margin-bottom:10px;">BINARY STATUS (LOWER 12 BITS)</div>
            <div id="bitGrid" class="bit-row"></div>
            
            <div id="math-display">
                <div id="math-n" style="color:var(--dim)"></div>
                <div id="math-minus" style="color:var(--dim)"></div>
                <div id="math-res" style="color:var(--accent); border-top: 1px solid #444; margin-top:5px; padding-top:5px;"></div>
            </div>
        </div>
        
        <div style="background:var(--card); padding:20px; border-radius:12px; text-align:center; border:1px solid #30363d;">
            <div style="font-size:11px; color:var(--dim)">TOTAL "1" BITS COUNT</div>
            <div id="countDisplay" style="font-size:48px; font-weight:bold; color:var(--energy);">0</div>
        </div>
        <div id="log" style="color:var(--accent); font-size:14px; font-weight:bold; text-align:center; padding:10px; min-height:20px;"></div>
    </div>

    <div class="editor">
        <div class="editor-header">
            <span style="font-size:13px; color:var(--dim)">Solution Code</span>
            <select id="langSelect" onchange="renderCode()">
                <option value="python">Python</option>
                <option value="c">C (Standard)</option>
            </select>
        </div>
        <div id="codeView" style="padding-top:15px;"></div>
    </div>
</div>

<script>
const codes = {
    python: {
        steps: [
            "def hammingWeight(n: int) -> int:",
            "    count = 0",
            "    while n != 0:",
            "        n = n & (n - 1)",
            "        count += 1",
            "    return count"
        ],
        map: { 1:1, 2:2, 3:3, 4:4, 5:5 },
        highlight: (l) => l.replace(/def|int|while|return/g, '<span class="kw">$&</span>')
    },
    c: {
        steps: [
            "int hammingWeight(uint32_t n) {",
            "    int count = 0;",
            "    while (n != 0) {",
            "        n &= (n - 1);",
            "        count++;",
            "    }",
            "    return count;",
            "}"
        ],
        map: { 1:1, 2:2, 3:3, 4:4, 5:6 },
        highlight: (l) => l.replace(/int|uint32_t|while|return/g, '<span class="tp">$&</span>')
    }
};

let n = 11;
let currentStep = 0;
let it;

function init() {
    n = 11;
    currentStep = 1;
    document.getElementById('countDisplay').innerText = "0";
    document.getElementById('nextBtn').disabled = false;
    document.getElementById('math-n').innerText = "";
    document.getElementById('math-minus').innerText = "";
    document.getElementById('math-res').innerText = "";
    document.getElementById('log').innerText = "";
    
    renderCode();
    renderBits(n);
    it = bitLogic();
}

function renderCode() {
    const lang = document.getElementById('langSelect').value;
    const config = codes[lang];
    const view = document.getElementById('codeView');
    
    view.innerHTML = config.steps.map((line, i) => {
        const activeClass = (i === config.map[currentStep]) ? 'ln-active' : '';
        return `<div class="ln ${activeClass}" id="ln-${i}"><span class="ln-num">${i}</span>${config.highlight(line)}</div>`;
    }).join('');
}

function toBin(num) {
    return (num >>> 0).toString(2).padStart(12, '0');
}

function renderBits(num, elimIdx = -1) {
    const grid = document.getElementById('bitGrid');
    grid.innerHTML = '';
    const bin = toBin(num);
    [...bin].forEach((bit, i) => {
        const div = document.createElement('div');
        div.className = 'bit-cell' + (bit === '1' ? ' is-one' : '');
        // è€ƒæ…®åˆ° toBin å›ºå®šçš„ 12 ä½å…ƒé•·åº¦ä¾†å®šä½æ¶ˆå»çš„è¦–è¦ºæ•ˆæœ
        if (elimIdx !== -1 && i === (12 - bin.length + elimIdx)) div.classList.add('eliminating');
        div.innerText = bit;
        grid.appendChild(div);
    });
}

function* bitLogic() {
    let count = 0;
    currentStep = 1;
    yield { m: `åˆå§‹åŒ–è®Šæ•¸ count = 0` };

    while (n !== 0) {
        currentStep = 2;
        yield { m: `æª¢æŸ¥ n æ˜¯å¦ç‚º 0 (ç›®å‰ n = ${n})` };
        
        const oldN = n;
        const nMinus1 = n - 1;
        const binStr = oldN.toString(2);
        const lastOneIdx = binStr.lastIndexOf('1');
        const realIdxIn12 = 12 - binStr.length + lastOneIdx;
        
        document.getElementById('math-n').innerText = `n     : ${toBin(oldN)}`;
        document.getElementById('math-minus').innerText = `n - 1 : ${toBin(nMinus1)}`;
        document.getElementById('math-res').innerText = `RESULT: ${toBin(oldN & nMinus1)}`;

        currentStep = 3;
        yield { m: `åŸ·è¡Œ n & (n - 1)ï¼Œæ¶ˆå»æœ€å¾Œä¸€å€‹ä½å…ƒ 1`, elim: lastOneIdx };
        
        n = n & nMinus1;
        count++;
        currentStep = 4;
        renderBits(n);
        document.getElementById('countDisplay').innerText = count;
        yield { m: `æˆåŠŸæ¶ˆå»ï¼Œcount ç´¯åŠ è‡³ ${count}` };
    }
    currentStep = 5;
    yield { m: `n å·²æ­¸é›¶ï¼ŒçµæŸè¿´åœˆä¸¦å›å‚³çµæœ ${count}` };
}

function next() {
    const s = it.next();
    if (s.done) { 
        document.getElementById('nextBtn').disabled = true; 
        return; 
    }
    
    const { m, elim } = s.value;
    document.getElementById('log').innerText = `> ${m}`;
    if (elim !== undefined) renderBits(n, elim);
    renderCode();
}

init();
</script>
</body>
</html>