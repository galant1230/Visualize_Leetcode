<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>Non-overlapping Intervals - Enhanced Viz</title>
    <style>
        :root {
            --bg: #0d1117; --card: #161b22; --accent: #58a6ff;
            --pacific: #1f6feb; --atlantic: #238636; --energy: #d29922; --danger: #f85149;
            --editor-bg: #010409; --text: #c9d1d9; --dim: #8b949e;
            --keyword: #ff7b72; --hl: rgba(88, 166, 255, 0.15);
        }
        body { font-family: 'Consolas', 'Segoe UI', monospace; background: var(--bg); color: var(--text); margin: 0; padding: 15px; overflow: hidden; }
        
        .container { 
            max-width: 1850px; 
            margin: auto; 
            display: grid; 
            grid-template-columns: 350px 1.2fr 480px; 
            gap: 20px; 
            height: 95vh; 
        }

        /* å·¦å´é¢æ¿ */
        .side-panel { background: var(--card); border: 1px solid #30363d; border-radius: 12px; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .info-card { background: #010409; border: 1px solid #30363d; padding: 14px; border-radius: 8px; font-size: 13px; line-height: 1.6; }
        .ex-box { background: #161b22; border-left: 3px solid var(--accent); padding: 10px; margin-top: 8px; font-size: 12px; color: var(--dim); }
        .tag { padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; background: rgba(88, 166, 255, 0.1); color: var(--accent); margin-right: 5px; }

        /* ä¸­é–“è¦–è¦ºåŒ–å€ */
        .main-panel { background: #010409; border: 1px solid #30363d; border-radius: 12px; padding: 20px; display: flex; flex-direction: column; gap: 15px; overflow: hidden; }
        .viz-area { 
            background: var(--card); border-radius: 8px; padding: 40px 20px; border: 1px solid #333; 
            position: relative; min-height: 320px; overflow-x: auto;
        }
        .timeline { position: absolute; height: 2px; background: #333; left: 20px; right: 20px; top: 160px; }
        
        .interval { 
            position: absolute; height: 35px; border-radius: 6px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 12px; font-weight: bold; border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); /* å¢åŠ å½ˆæ€§å‹•ç•« */
        }
        /* åˆå§‹äº‚åºç‹€æ…‹çš„é«˜äº® */
        .interval.orig { background: #21262d; color: var(--dim); }
        .interval.keep { background: var(--atlantic); border-color: #3fb950; color: white; top: 200px !important; }
        .interval.remove { background: var(--danger); border-color: #f85149; color: white; top: 40px !important; opacity: 0.5; text-decoration: line-through; }
        .interval.active { border-color: var(--accent); box-shadow: 0 0 15px var(--accent); z-index: 11; }

        /* å³å´ä»£ç¢¼å€ */
        .editor { background: var(--editor-bg); border: 1px solid #30363d; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; width: 480px; }
        .code-header { background: #161b22; padding: 12px 20px; border-bottom: 1px solid #30363d; font-size: 13px; color: var(--dim); }
        .ln { white-space: pre; padding: 0 15px 0 65px; position: relative; line-height: 2.0; font-size: 15px; }
        .ln-num { position: absolute; left: 0; width: 50px; text-align: right; color: #484f58; padding-right: 15px; border-right: 1px solid #30363d; }
        .ln-active { background: var(--hl); border-left: 4px solid var(--accent); }
        .kw { color: var(--keyword); }

        .toolbar { grid-column: span 3; background: var(--card); padding: 12px 20px; border-radius: 12px; display: flex; justify-content: space-between; border: 1px solid #30363d; }
        .btn { background: var(--pacific); color: white; border: none; padding: 10px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        #resCount { font-size: 32px; font-weight: bold; color: var(--danger); margin-top: 10px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="toolbar">
        <div style="font-weight:bold; color:var(--accent); font-size:20px;">435. Non-overlapping Intervals <span style="font-size:13px; font-weight:normal; color:var(--dim);">With Dynamic Sorting</span></div>
        <div style="display:flex; gap:12px;">
            <button class="btn" id="nextBtn" onclick="next()">é–‹å§‹ Step ğŸ§­</button>
            <button class="btn" style="background:#21262d" onclick="init()">é‡ç½®</button>
        </div>
    </div>

    <div class="side-panel">
        <div class="info-card">
            <b style="color:var(--accent); font-size:15px;">ğŸ“– é¡Œç›®æè¿°</b><br>
            çµ¦äºˆ <code>intervals</code>ï¼Œè¨ˆç®—æœ€å°‘ç§»é™¤å¤šå°‘å€é–“ä»¥æ¶ˆé™¤æ‰€æœ‰é‡ç–Šã€‚
        </div>

        <div class="info-card">
            <b style="color:var(--energy); font-size:15px;">ğŸ’¡ ç¯„ä¾‹è§£æ</b>
            <div class="ex-box">
                <b>Input:</b> [[1,2],[2,3],[3,4],[1,3]]<br>
                <b>Sorted:</b> [[1,2],[2,3],[1,3],[3,4]] (ä¾ End æ’åº)<br>
                <b>Output:</b> 1 (ç§»é™¤ [1,3])
            </div>
        </div>

        <div class="info-card">
            <b style="color:var(--atlantic); font-size:15px;">ğŸ§  è²ªå¿ƒç­–ç•¥</b><br>
            ç‚ºä»€éº¼è¦æŒ‰ <b>End</b> æ’åºï¼Ÿ<br>
            å› ç‚ºè¶Šæ—©çµæŸï¼Œç•™çµ¦å¾Œé¢çš„ç©ºé–“å°±è¶Šå¤§ã€‚é€™èƒ½ç¢ºä¿æˆ‘å€‘æ¯ä¸€æ­¥éƒ½åšå‡ºå°æœªä¾†æœ€æœ‰åˆ©çš„é¸æ“‡ã€‚
        </div>

        <div class="info-card">
            <span class="tag">Time: O(N log N)</span><span class="tag">Space: O(1)</span>
        </div>
    </div>

    <div class="main-panel">
        <div class="viz-area" id="vizArea">
            <div class="timeline"></div>
        </div>
        <div class="viz-area" style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
            <div style="font-size:11px; color:var(--dim); letter-spacing: 2px;">REMOVED COUNT</div>
            <div id="resCount">0</div>
            <div id="log" style="color:var(--accent); font-size:14px; margin-top:15px; font-weight: bold; background: rgba(88,166,255,0.05); padding: 8px 15px; border-radius: 20px; text-align: center; min-width: 80%;"></div>
        </div>
    </div>

    <div class="editor">
        <div class="code-header"><span>erase_overlap.py</span></div>
        <div id="codeView" class="code-body" style="padding-top: 15px;"></div>
    </div>
</div>

<script>
const codeLines = [
    "intervals.sort(key=lambda x: x[1])",
    "prev_end = float('-inf')",
    "removed = 0",
    "for start, end in intervals:",
    "    if start >= prev_end:",
    "        prev_end = end",
    "    else:",
    "        removed += 1",
    "return removed"
];

// åŸå§‹è¼¸å…¥ (äº‚åº)
const rawData = [[1,2],[2,3],[3,4],[1,3]];
let it;
const SCALE = 85; 

function init() {
    const viz = document.getElementById('vizArea');
    viz.innerHTML = '<div class="timeline"></div>';
    document.getElementById('nextBtn').disabled = false;
    document.getElementById('nextBtn').innerText = "é–‹å§‹æ’åº ğŸ”„";

    // åˆå§‹ï¼šäº‚åºé¡¯ç¤ºï¼Œä¸”å‚ç›´ä½ç½®éŒ¯é–‹ä»¥ä¾¿è§€å¯Ÿ
    rawData.forEach((int, idx) => {
        const el = document.createElement('div');
        el.className = 'interval orig';
        el.id = `int-${idx}`;
        el.style.left = `${int[0] * SCALE + 50}px`;
        el.style.width = `${(int[1] - int[0]) * SCALE}px`;
        // åˆå§‹é«˜åº¦äº‚æ’
        el.style.top = `${80 + (idx * 20)}px`;
        el.innerText = `[${int[0]},${int[1]}]`;
        el.dataset.start = int[0];
        el.dataset.end = int[1];
        viz.appendChild(el);
    });

    document.getElementById('codeView').innerHTML = codeLines.map((l, i) => {
        const formatted = l.replace(/for|in|if|else|return|lambda|sort|key/g, '<span class="kw">$&</span>');
        return `<div class="ln" id="ln-${i}"><span class="ln-num">${i+1}</span>${formatted}</div>`;
    }).join('');

    it = solveLogic();
    document.getElementById('resCount').innerText = "0";
    document.getElementById('log').innerText = "é€™æ˜¯åŸå§‹è¼¸å…¥ã€‚é»æ“ŠæŒ‰éˆ•é€²è¡Œæ’åº...";
}

function* solveLogic() {
    // æ­¥é©Ÿ 1: æ’åºå‹•ç•«
    yield { ln: 0, m: "æ­£åœ¨æŒ‰çµæŸæ™‚é–“ (End) é€²è¡Œæ’åº..." };
    
    const sortedIndices = [0, 1, 3, 2]; // å°æ‡‰ rawData æ’åºå¾Œçš„ç´¢å¼•
    const sortedData = sortedIndices.map(idx => rawData[idx]);

    sortedIndices.forEach((originalIdx, sortedPos) => {
        const el = document.getElementById(`int-${originalIdx}`);
        el.style.top = "100px"; // å…¨éƒ¨æ­¸ä½åˆ°åŒä¸€æ°´å¹³ç·š
        // æ³¨æ„ï¼šé€™è£¡æˆ‘å€‘ä¸æ”¹è®Š leftï¼Œå› ç‚ºæ•¸å€¼æ²’è®Šï¼Œä½†æˆ‘å€‘æœƒé‡æ–°æ¨™è¨˜é †åºæ„Ÿ
        el.style.transitionDelay = `${sortedPos * 0.1}s`;
    });

    yield { ln: 1, m: "æ’åºå®Œæˆï¼åˆå§‹åŒ– prev_end ç‚º -âˆ" };
    
    let prev_end = -Infinity;
    let removed = 0;
    yield { ln: 2, m: "åˆå§‹åŒ–ç§»é™¤è¨ˆæ•¸å™¨ç‚º 0" };

    // æŒ‰ç…§æ’åºå¾Œçš„é †åºé€²è¡Œé‚è¼¯æª¢æŸ¥
    for (let i = 0; i < sortedIndices.length; i++) {
        const originalIdx = sortedIndices[i];
        const [start, end] = rawData[originalIdx];
        
        yield { ln: 3, activeIdx: originalIdx, m: `æª¢æŸ¥å€é–“ [${start}, ${end}]...` };
        
        if (start >= prev_end) {
            prev_end = end;
            yield { ln: 5, activeIdx: originalIdx, status: 'keep', m: `âœ… start(${start}) >= prev_end(${prev_end === -Infinity ? '-âˆ' : prev_end})ï¼Œä¿ç•™ï¼` };
        } else {
            removed++;
            yield { ln: 7, activeIdx: originalIdx, status: 'remove', count: removed, m: `âŒ é‡ç–Šï¼start(${start}) < prev_end(${prev_end})ï¼Œç§»é™¤ã€‚` };
        }
    }
    yield { ln: 8, m: "å®Œæˆï¼ç§»é™¤æœ€å°‘ 1 å€‹å€é–“å³å¯é”æˆç›®æ¨™ã€‚" };
}

function next() {
    const s = it.next();
    if (s.done) {
        document.getElementById('nextBtn').disabled = true;
        return;
    }
    
    document.getElementById('nextBtn').innerText = "ä¸‹ä¸€æ­¥ ğŸ§­";
    const { ln, activeIdx, status, count, m } = s.value;

    document.querySelectorAll('.ln').forEach(e => e.classList.remove('ln-active'));
    document.getElementById(`ln-${ln}`).classList.add('ln-active');
    
    document.querySelectorAll('.interval').forEach(e => e.classList.remove('active'));
    
    if (activeIdx !== undefined) {
        const el = document.getElementById(`int-${activeIdx}`);
        el.classList.add('active');
        if (status === 'keep') el.classList.add('keep');
        if (status === 'remove') el.classList.add('remove');
    }

    if (count !== undefined) document.getElementById('resCount').innerText = count;
    document.getElementById('log').innerText = `> ${m}`;
}

init();
</script>
</body>
</html>