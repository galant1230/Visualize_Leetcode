<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>572. Subtree of Another Tree - IDE Style</title>
    <style>
        :root {
            --primary: #8b5cf6; --bg: #0d1117; --line-active: #21262d;
            --kw: #ff7b72; --fn: #d2a8ff; --vr: #ffa657; --tp: #79c0ff; --st: #a5d6ff; --cm: #8b949e;
            --complexity-bg: #161b22; --match: #10b981;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        /* 畫布 */
        .stage-container { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 15px; margin-bottom: 20px; }
        .tree-stage { background: #ffffff; border: 1px solid #d0d7de; border-radius: 8px; height: 260px; position: relative; overflow: hidden; }
        .stage-title { position: absolute; top: 10px; left: 15px; font-size: 11px; font-weight: bold; color: #8b949e; z-index: 10; letter-spacing: 1px; }
        
        .tree-node { position: absolute; width: 32px; height: 32px; background: #fff; border: 2px solid #30363d; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; transition: all 0.4s ease; z-index: 2; transform: translateX(-50%); font-size: 13px; }
        .node-scanning { border-color: var(--primary); background: #f5f3ff; color: var(--primary); box-shadow: 0 0 15px rgba(139, 92, 246, 0.4); border-style: dashed; }
        .node-match { border-color: var(--match); background: #ecfdf5; color: var(--match); box-shadow: 0 0 15px rgba(16, 185, 129, 0.4); }

        /* 代碼區域 - 強化縮排 */
        .grid { display: grid; grid-template-columns: 1.1fr 0.9fr; gap: 20px; }
        .code-window { background: var(--bg); border-radius: 8px; overflow: hidden; border: 1px solid #30363d; }
        .code-header { background: #161b22; padding: 10px 15px; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; }
        .code-panel { color: #c9d1d9; padding: 15px; font-family: 'Fira Code', 'Consolas', monospace; font-size: 12.5px; height: 350px; overflow-y: auto; line-height: 1.7; }
        .line { display: flex; opacity: 0.3; transition: 0.2s; border-left: 3px solid transparent; }
        .line-num { width: 30px; color: #484f58; text-align: right; padding-right: 15px; user-select: none; }
        .line-content { white-space: pre; } /* 重要：保留縮排 */
        .active-line { opacity: 1; background: var(--line-active); border-left-color: var(--primary); }

        /* 側邊面板 */
        .side-label { font-size: 11px; font-weight: bold; color: #57606a; margin-bottom: 6px; display: block; text-transform: uppercase; }
        .stack-panel { background: #161b22; color: #8b949e; padding: 12px; border-radius: 8px; display: flex; flex-direction: column-reverse; gap: 5px; min-height: 80px; border: 1px solid #30363d; margin-bottom: 15px; }
        .stack-frame { padding: 4px 8px; background: rgba(139, 92, 246, 0.1); color: var(--tp); border-radius: 4px; border-left: 2px solid var(--primary); font-size: 10px; }
        
        #stepDesc { padding: 12px; background: white; border: 1px solid #d0d7de; border-radius: 8px; font-size: 13px; min-height: 70px; color: #24292f; margin-bottom: 15px; line-height: 1.5; }
        .complexity-box { background: var(--complexity-bg); border: 1px solid #30363d; border-radius: 8px; padding: 12px; color: #c9d1d9; font-size: 12px; }
        
        .k { color: var(--kw); } .t { color: var(--tp); } .v { color: var(--vr); } .f { color: var(--fn); } .c { color: var(--cm); } .n { color: #79c0ff; }
        svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        line { stroke: #d0d7de; stroke-width: 1.5; }
        button { padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: 600; border: 1px solid #d0d7de; background: white; }
        .btn-primary { background: var(--primary); color: white; border: none; }
    </style>
</head>
<body>

<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div>
            <h2 style="margin:0; font-size: 1.3rem;">572. Subtree of Another Tree</h2>
            <code style="font-size: 11px; color: #57606a;">Input: root = [3,4,5,1,2], subRoot = [4,1,2] → Output: true</code>
        </div>
        <div style="display: flex; gap: 8px;">
            <select id="langSelect" onchange="init()" style="padding: 6px 10px; border-radius: 6px; border: 1px solid #d0d7de;">
                <option value="py">Python 3</option>
                <option value="c">C Language</option>
            </select>
            <button class="btn-primary" onclick="runStep()">下一步 Step ▶</button>
            <button onclick="init()">重置</button>
        </div>
    </div>

    <div class="stage-container">
        <div class="tree-stage"><div class="stage-title">MAIN TREE (ROOT)</div><svg id="svgRoot"></svg><div id="nodesRoot"></div></div>
        <div class="tree-stage"><div class="stage-title">SUBTREE (SUBROOT)</div><svg id="svgSub"></svg><div id="nodesSub"></div></div>
    </div>

    <div class="grid">
        <div class="code-window">
            <div class="code-header"><span id="fileName" style="color:#8b949e; font-size:12px;">solution.py</span></div>
            <div class="code-panel" id="codePanel"></div>
        </div>
        
        <div class="status-wrapper">
            <span class="side-label">Call Stack</span>
            <div class="stack-panel" id="stackPanel"></div>
            <span class="side-label">Execution Insight</span>
            <div id="stepDesc"></div>
            <span class="side-label">Complexity Analysis</span>
            <div class="complexity-box">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;"><span>Time Complexity</span><span style="color:var(--fn); font-weight:bold;">O(N * M)</span></div>
                <div style="display:flex; justify-content:space-between;"><span>Space Complexity</span><span style="color:var(--fn); font-weight:bold;">O(H)</span></div>
            </div>
        </div>
    </div>
</div>

<script>
    let step = 0;
    const rootTree = [
        {id:3, v:'3', x:50, y:40, p:null}, {id:4, v:'4', x:30, y:120, p:3}, {id:5, v:'5', x:70, y:120, p:3},
        {id:1, v:'1', x:20, y:200, p:4}, {id:2, v:'2', x:40, y:200, p:4}
    ];
    const subTree = [ {id:'s4', v:'4', x:50, y:60, p:null}, {id:'s1', v:'1', x:30, y:140, p:'s4'}, {id:'s2', v:'2', x:70, y:140, p:'s4'} ];

    const allCodes = {
        py: { name: 'solution.py', lines: [
            `<span class="k">def</span> <span class="f">isSubtree</span>(<span class="v">self</span>, <span class="v">root</span>, <span class="v">sub</span>):`,
            `    <span class="k">if not</span> <span class="v">root</span>: <span class="k">return</span> <span class="n">False</span>`,
            `    <span class="k">if</span> <span class="v">self</span>.<span class="f">isSame</span>(<span class="v">root</span>, <span class="v">sub</span>): <span class="k">return</span> <span class="n">True</span>`,
            `    <span class="k">return</span> <span class="v">self</span>.<span class="f">isSubtree</span>(<span class="v">root</span>.<span class="v">left</span>, <span class="v">sub</span>) <span class="k">or</span> \\`,
            `           <span class="v">self</span>.<span class="f">isSubtree</span>(<span class="v">root</span>.<span class="v">right</span>, <span class="v">sub</span>)`,
            ` `,
            `<span class="k">def</span> <span class="f">isSame</span>(<span class="v">self</span>, <span class="v">p</span>, <span class="v">q</span>):`,
            `    <span class="k">if not</span> <span class="v">p</span> <span class="k">and not</span> <span class="v">q</span>: <span class="k">return</span> <span class="n">True</span>`,
            `    <span class="k">if not</span> <span class="v">p</span> <span class="k">or not</span> <span class="v">q</span>: <span class="k">return</span> <span class="n">False</span>`,
            `    <span class="k">if</span> <span class="v">p</span>.<span class="v">val</span> != <span class="v">q</span>.<span class="v">val</span>: <span class="k">return</span> <span class="n">False</span>`,
            `    <span class="k">return</span> <span class="v">self</span>.<span class="f">isSame</span>(<span class="v">p</span>.<span class="v">left</span>, <span class="v">q</span>.<span class="v">left</span>) <span class="k">and</span> \\`,
            `           <span class="v">self</span>.<span class="f">isSame</span>(<span class="v">p</span>.<span class="v">right</span>, <span class="v">q</span>.<span class="v">right</span>)`
        ]},
        c: { name: 'solution.c', lines: [
            `<span class="k">bool</span> <span class="f">isSubtree</span>(<span class="k">struct</span> <span class="t">TreeNode</span>* <span class="v">r</span>, <span class="k">struct</span> <span class="t">TreeNode</span>* <span class="v">s</span>) {`,
            `    <span class="k">if</span> (!<span class="v">r</span>) <span class="k">return</span> <span class="n">false</span>;`,
            `    <span class="k">if</span> (<span class="f">isSame</span>(<span class="v">r</span>, <span class="v">s</span>)) <span class="k">return</span> <span class="n">true</span>;`,
            `    <span class="k">return</span> <span class="f">isSubtree</span>(<span class="v">r</span>-><span class="v">left</span>, <span class="v">s</span>) || <span class="f">isSubtree</span>(<span class="v">r</span>-><span class="v">right</span>, <span class="v">s</span>);`,
            `}`,
            ` `,
            `<span class="k">bool</span> <span class="f">isSame</span>(<span class="k">struct</span> <span class="t">TreeNode</span>* <span class="v">p</span>, <span class="k">struct</span> <span class="t">TreeNode</span>* <span class="v">q</span>) {`,
            `    <span class="k">if</span> (!<span class="v">p</span> && !<span class="v">q</span>) <span class="k">return</span> <span class="n">true</span>;`,
            `    <span class="k">if</span> (!<span class="v">p</span> || !<span class="v">q</span> || <span class="v">p</span>-><span class="v">val</span> != <span class="v">q</span>-><span class="v">val</span>) <span class="k">return</span> <span class="n">false</span>;`,
            `    <span class="k">return</span> <span class="f">isSame</span>(<span class="v">p</span>-><span class="v">left</span>, <span class="v">q</span>-><span class="v">left</span>) && <span class="f">isSame</span>(<span class="v">p</span>-><span class="v">right</span>, <span class="v">q</span>-><span class="v">right</span>);`,
            `}`
        ]}
    };

    const trace = [
        { py: 0, c: 0, stack: ['isSubtree(root3, sub4)'], activeR: 3, desc: '<b>掃描：</b>檢查節點 3。' },
        { py: 2, c: 2, stack: ['isSubtree(root3, sub4)', 'isSame(3, 4)'], activeR: 3, desc: '呼叫 isSame，數值 3 != 4，回傳 False。' },
        { py: 3, c: 3, stack: ['isSubtree(root3, sub4)', 'isSubtree(root4, sub4)'], activeR: 4, desc: '<b>遞迴：</b>搜尋左子樹節點 4。' },
        { py: 2, c: 2, stack: ['...root4, sub4)', 'isSame(4, 4)'], activeR: 4, status: 'match', desc: '數值匹配！開始深度比對結構。' },
        { py: 10, c: 9, stack: ['isSame(4,4)', 'isSame(1,1)', 'isSame(2,2)'], activeR: 4, status: 'match', desc: '左右子節點 1 與 2 完全一致。' },
        { py: 2, c: 2, stack: [], activeR: 4, status: 'match', desc: '<b>匹配成功：</b>在大樹中找到子樹結構！' }
    ];

    function init() { step = 0; renderCode(); render(); }
    function runStep() { if (step < trace.length - 1) { step++; render(); } }

    function renderCode() {
        const lang = document.getElementById('langSelect').value;
        const info = allCodes[lang];
        document.getElementById('fileName').innerText = info.name;
        document.getElementById('codePanel').innerHTML = info.lines.map((l, i) => `
            <div class="line" id="line-${i}"><div class="line-num">${i + 1}</div><div class="line-content">${l}</div></div>
        `).join('');
    }

    function renderTree(tree, containerId, svgId, activeId, status) {
        const container = document.getElementById(containerId);
        const svg = document.getElementById(svgId);
        container.innerHTML = ''; svg.innerHTML = '';
        tree.forEach(n => {
            const div = document.createElement('div');
            let cls = 'tree-node';
            if (n.id === activeId) cls += (status === 'match' ? ' node-match' : ' node-scanning');
            div.className = cls;
            div.style.left = n.x + '%'; div.style.top = n.y + 'px';
            div.innerText = n.v; container.appendChild(div);
            if (n.p !== null) {
                const parent = tree.find(p => p.id === n.p);
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", n.x + "%"); line.setAttribute("y1", n.y);
                line.setAttribute("x2", parent.x + "%"); line.setAttribute("y2", parent.y + 16);
                svg.appendChild(line);
            }
        });
    }

    function render() {
        const lang = document.getElementById('langSelect').value;
        const data = trace[step];
        document.getElementById('stackPanel').innerHTML = data.stack.map(s => `<div class="stack-frame">${s}</div>`).join('');
        document.getElementById('stepDesc').innerHTML = data.desc;
        document.querySelectorAll('.line').forEach(l => l.classList.remove('active-line'));
        if (data[lang] !== undefined) document.getElementById(`line-${data[lang]}`).classList.add('active-line');
        renderTree(rootTree, 'nodesRoot', 'svgRoot', data.activeR, data.status);
        renderTree(subTree, 'nodesSub', 'svgSub', null, null);
    }
    init();
</script>
</body>
</html>
