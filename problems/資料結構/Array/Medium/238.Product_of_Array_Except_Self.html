<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>238. Product of Array Except Self å®Œæ•´æ•™å­¸ç‰ˆ</title>
  <style>
    :root {
      --primary: #007acc; --success: #2ecc71; --warning: #f39c12;
      --danger: #e74c3c; --dark: #2c3e50; --bg: #f4f7f9;
    }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--dark); line-height: 1.6; }
    .dashboard { max-width: 1200px; margin: auto; display: grid; grid-template-columns: 1.2fr 1fr; gap: 20px; }
    
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .full-width { grid-column: span 2; }
    h2 { margin-top: 0; color: var(--primary); border-bottom: 2px solid #eee; padding-bottom: 10px; font-size: 1.25rem; }
    
    /* é¡Œç›®è³‡è¨Šå€ */
    .problem-info { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 10px; }
    .example-box { background: #f8f9fa; padding: 15px; border-left: 4px solid var(--warning); font-family: monospace; font-size: 0.9rem; border-radius: 0 8px 8px 0; }
    .logic-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
    .logic-table th, .logic-table td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    .logic-table th { background: #f1f1f1; }

    /* æ§åˆ¶é¢æ¿ */
    .controls { display: flex; gap: 10px; margin: 20px 0; justify-content: center; align-items: center; flex-wrap: wrap; }
    select, input { padding: 8px 15px; border: 2px solid #ddd; border-radius: 25px; outline: none; }
    button { padding: 8px 25px; border: none; border-radius: 25px; cursor: pointer; background: var(--primary); color: white; font-weight: bold; }
    button:disabled { background: #ccc; }

    /* è¦–è¦ºåŒ–å…ƒä»¶ */
    .array-container { display: flex; flex-direction: column; gap: 15px; margin: 20px 0; align-items: center; }
    .row { display: flex; align-items: center; gap: 10px; }
    .label { width: 140px; font-weight: bold; font-size: 0.9rem; text-align: right; }
    .box-row { display: flex; gap: 8px; }
    .box { 
      width: 50px; height: 50px; border: 2px solid #ddd; border-radius: 8px; 
      display: flex; align-items: center; justify-content: center; font-weight: bold;
      background: white; transition: all 0.2s; font-size: 1rem;
    }
    .box.active { border-color: var(--warning); background: #fff8e1; transform: scale(1.1); }
    .box.target { background: #fce4ec; border-color: var(--danger); }

    /* ä»£ç¢¼è¦–çª— */
    .code-window { background: #282c34; color: #abb2bf; padding: 15px; border-radius: 8px; font-family: 'Consolas', monospace; font-size: 0.85rem; line-height: 1.5; min-height: 320px; }
    .line { padding: 1px 10px; border-left: 4px solid transparent; }
    .line.active { background: #3e4451; border-left-color: var(--success); color: white; }
    
    .status-msg { font-weight: bold; color: var(--primary); text-align: center; height: 1.5rem; }
  </style>
</head>
<body>

<div class="dashboard">
  <div class="card full-width">
    <h2>ğŸ“Œ 238. Product of Array Except Self</h2>
    <div class="problem-info">
      <div>
        <p><strong>é¡Œç›®æè¿°ï¼š</strong> çµ¦å®šä¸€å€‹é™£åˆ— <code>nums</code>ï¼Œå›å‚³ä¸€å€‹æ–°é™£åˆ—ï¼Œå…¶ä¸­æ¯å€‹å…ƒç´ æ˜¯é™¤äº†è‡ªå·±ä»¥å¤–çš„æ‰€æœ‰æ•¸å­—ä¹˜ç©ã€‚</p>
        <p><strong>é™åˆ¶æ¢ä»¶ï¼š</strong>
          <br>1. æ™‚é–“è¤‡é›œåº¦å¿…é ˆæ˜¯ <strong>O(n)</strong>ã€‚
          <br>2. <strong>ä¸èƒ½ä½¿ç”¨é™¤æ³•</strong> (Sol 2 é™¤å¤–ï¼Œåƒ…ä¾›å°ç…§)ã€‚
          <br>3. é¡å¤–ç©ºé–“è¤‡é›œåº¦ <strong>O(1)</strong> (è¼¸å‡ºé™£åˆ—ä¸è¨ˆå…¥)ã€‚
        </p>
      </div>
      <div class="example-box">
        <strong>ç¯„ä¾‹ï¼š</strong> nums = [1, 2, 3, 4]<br>
        1. é™¤ 1 ä»¥å¤–: 2*3*4 = 24<br>
        2. é™¤ 2 ä»¥å¤–: 1*3*4 = 12<br>
        3. é™¤ 3 ä»¥å¤–: 1*2*4 = 8<br>
        4. é™¤ 4 ä»¥å¤–: 1*2*3 = 6<br>
        <strong>çµæœï¼š[24, 12, 8, 6]</strong>
      </div>
    </div>

    <div id="logicExplanation" style="display:none;">
      <h3>ğŸ’¡ Sol 3 æ ¸å¿ƒé‚è¼¯ (Prefix & Suffix)</h3>
      <table class="logic-table">
        <tr><th>Index</th><th>0</th><th>1</th><th>2</th><th>3</th></tr>
        <tr><td>nums</td><td>1</td><td>2</td><td>3</td><td>4</td></tr>
        <tr style="color:var(--primary)"><td>Prefix (å·¦å´ç©)</td><td>1</td><td>1</td><td>2</td><td>6</td></tr>
        <tr style="color:var(--success)"><td>Suffix (å³å´ç©)</td><td>24</td><td>12</td><td>4</td><td>1</td></tr>
        <tr style="font-weight:bold; background:#e8f5e9;"><td>çµæœ (å·¦*å³)</td><td>24</td><td>12</td><td>8</td><td>6</td></tr>
      </table>
    </div>
  </div>

  <div class="card full-width" style="background: transparent; box-shadow: none; padding: 0;">
    <div class="controls">
      åˆ‡æ›è§£æ³•ï¼š
      <select id="algoSelect" onchange="initSim()">
        <option value="sol1">Sol 1: æš´åŠ›æ³• (O(nÂ²))</option>
        <option value="sol2">Sol 2: é™¤æ³• (è™•ç† 0)</option>
        <option value="sol3" selected>Sol 3: å‰å¾Œç¶´ (é¢è©¦æœ€å„ª)</option>
      </select>
      æ¸¬è©¦æ•¸æ“š: <input type="text" id="inputNums" value="1, 2, 3, 4" style="width: 150px;">
      <button onclick="initSim()">é‡ç½®</button>
      <button id="nextBtn" onclick="runStep()">ä¸‹ä¸€æ­¥ (Step)</button>
    </div>
    <div class="status-msg" id="statusMsg">é»æ“Šä¸‹ä¸€æ­¥é–‹å§‹æ¨¡æ“¬</div>
  </div>

  <div class="card">
    <h2>ğŸ” è¦–è¦ºåŒ–è¿½è¹¤</h2>
    <div class="array-container">
      <div class="row">
        <div class="label">Input (nums):</div>
        <div class="box-row" id="numsRow"></div>
      </div>
      <div class="row">
        <div class="label">Result (res):</div>
        <div class="box-row" id="resRow"></div>
      </div>
    </div>
    <div id="varDisplay" style="text-align:center; font-family:monospace; background:#f1f1f1; padding:10px; border-radius:8px;"></div>
  </div>

  <div class="card">
    <h2>Python å¯¦ä½œ</h2>
    <div class="code-window" id="codeDisplay"></div>
  </div>
</div>

<script>
const configs = {
  sol1: {
    code: ["for i in range(n):","    prod = 1","    for j in range(n):","        if i == j: continue","        prod *= nums[j]","    res[i] = prod"],
    showTable: false
  },
  sol2: {
    code: ["for num in nums:","    if num: prod *= num","    else: zero_cnt += 1","for i, c in enumerate(nums)","    if zero_cnt > 1: res[i] = 0","    elif zero_cnt == 1: res[i] = prod if not c else 0","    else: res[i] = prod // c"],
    showTable: false
  },
  sol3: {
    code: ["prefix = 1","for i in range(n):","    res[i] = prefix","    prefix *= nums[i]","suffix = 1","for i in range(n-1, -1, -1):","    res[i] *= suffix","    suffix *= nums[i]"],
    showTable: true
  }
};

let nums = [], res = [], i = 0, j = 0, state = "start", prefix = 1, suffix = 1;

function initSim() {
  const algo = document.getElementById('algoSelect').value;
  nums = document.getElementById('inputNums').value.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));
  res = new Array(nums.length).fill(0);
  i = 0; j = 0; state = "start"; prefix = 1; suffix = 1;
  
  document.getElementById('codeDisplay').innerHTML = configs[algo].code.map((l, idx) => `<div class="line" id="l${idx}">${l}</div>`).join('');
  document.getElementById('logicExplanation').style.display = configs[algo].showTable ? 'block' : 'none';
  document.getElementById('nextBtn').disabled = false;
  document.getElementById('statusMsg').innerText = "æº–å‚™å°±ç·’";
  render();
}

function render() {
  const algo = document.getElementById('algoSelect').value;
  const nRow = document.getElementById('numsRow');
  const rRow = document.getElementById('resRow');
  
  nRow.innerHTML = nums.map((val, idx) => {
    let cls = 'box';
    if (algo === 'sol1' && idx === i) cls += ' target';
    if (idx === (algo === 'sol1' && state === 'inner' ? j : i)) cls += ' active';
    return `<div class="${cls}">${val}</div>`;
  }).join('');

  rRow.innerHTML = res.map((val, idx) => `<div class="box ${idx === i ? 'active' : ''}">${val}</div>`).join('');
}

function runStep() {
  const algo = document.getElementById('algoSelect').value;
  const msg = document.getElementById('statusMsg');
  const vDisp = document.getElementById('varDisplay');
  clearHighlight();

  if (algo === 'sol1') {
    if (i < nums.length) {
      if (state === "start") {
        highlight(1); res[i] = 1; j = 0; state = "inner";
        msg.innerText = `æº–å‚™è¨ˆç®—ç¬¬ ${i} ä½`;
      } else if (j < nums.length) {
        highlight(3); highlight(4);
        if (i !== j) res[i] *= nums[j];
        vDisp.innerText = `è¨ˆç®—ä¸­: res[${i}] = ${res[i]}`;
        j++;
      } else {
        highlight(5);
        i++; state = "start";
      }
    } else { msg.innerText = "æ¨¡æ“¬çµæŸ"; document.getElementById('nextBtn').disabled = true; }
  } 
  else if (algo === 'sol2') {
    const zeroCnt = nums.filter(x => x === 0).length;
    const prod = nums.filter(x => x !== 0).reduce((a,b) => a*b, 1);
    if (i < nums.length) {
      highlight(4); highlight(5); highlight(6);
      if (zeroCnt > 1) res[i] = 0;
      else if (zeroCnt === 1) res[i] = (nums[i] === 0 ? prod : 0);
      else res[i] = prod / nums[i];
      msg.innerText = `è™•ç†ç´¢å¼• ${i}`;
      vDisp.innerText = `éé›¶ä¹˜ç©: ${prod}, é›¶å€‹æ•¸: ${zeroCnt}`;
      i++;
    } else { msg.innerText = "å®Œæˆ"; document.getElementById('nextBtn').disabled = true; }
  }
  else if (algo === 'sol3') {
    if (state === "start") {
      highlight(2); highlight(3);
      if (i === 0) res.fill(1);
      res[i] = prefix;
      msg.innerText = `Prefix éšæ®µï¼šres[${i}] = ${prefix}`;
      prefix *= nums[i];
      vDisp.innerText = `ä¸‹ä¸€å€‹å‰ç¶´ç©: ${prefix}`;
      i++;
      if (i === nums.length) { state = "suffix"; i = nums.length - 1; }
    } else {
      highlight(6); highlight(7);
      res[i] *= suffix;
      msg.innerText = `Suffix éšæ®µï¼šres[${i}] æ›´æ–°ç‚º ${res[i]}`;
      suffix *= nums[i];
      vDisp.innerText = `ä¸‹ä¸€å€‹å¾Œç¶´ç©: ${suffix}`;
      i--;
      if (i < 0) { msg.innerText = "å‰å¾Œç¶´è¨ˆç®—å®Œæˆï¼"; document.getElementById('nextBtn').disabled = true; }
    }
  }
  render();
}

function highlight(id) { 
  const el = document.getElementById('l' + id);
  if (el) el.classList.add('active'); 
}
function clearHighlight() { document.querySelectorAll('.line').forEach(l => l.classList.remove('active')); }

initSim();
</script>
</body>
</html>
