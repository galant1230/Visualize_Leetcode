<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>424. Longest Repeating Character Replacement æ·±åº¦è§£æ</title>
  <style>
    :root {
      --primary: #64ffda; --accent: #007acc; --bg: #0a192f;
      --card-bg: #112240; --text: #ccd6f6; --text-dim: #8892b0; --success: #2ecc71; --danger: #ff4d4d; --warning: #f1c40f;
    }
    body {
      font-family: 'Fira Code', 'Segoe UI', sans-serif; background: var(--bg);
      color: var(--text); padding: 20px; margin: 0; line-height: 1.6;
    }
    .dashboard { max-width: 1250px; margin: auto; display: grid; grid-template-columns: 1.2fr 1fr; gap: 20px; }
    .card { background: var(--card-bg); padding: 25px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .full-width { grid-column: span 2; }
    h2, h3 { color: var(--primary); margin-top: 0; border-bottom: 1px solid #233554; padding-bottom: 10px; }

    /* é¡Œç›®è§£æå€ */
    .info-section { background: rgba(100, 255, 218, 0.05); border-left: 5px solid var(--primary); padding: 15px; margin-bottom: 20px; border-radius: 4px; font-size: 0.9rem; }
    .complexity-tag { display: inline-block; padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; background: rgba(0, 122, 204, 0.2); border: 1px solid var(--accent); margin-right: 5px; }

    /* æ ¸å¿ƒç‹€æ…‹é¢æ¿ */
    .status-panel { 
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; 
      margin: 15px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px; border: 1px solid #233554;
    }
    .status-item { text-align: center; }
    .status-label { font-size: 0.8rem; color: var(--text-dim); display: block; }
    .status-value { font-size: 1.1rem; color: var(--primary); font-weight: bold; }

    /* æ»‘å‹•çª—å£è¦–è¦ºåŒ– */
    .window-visual {
      display: flex; justify-content: center; align-items: flex-start;
      margin: 60px 0 40px 0; min-height: 100px; position: relative;
    }
    .cell-container { display: flex; flex-direction: column; align-items: center; width: 50px; position: relative; }
    .cell {
      width: 40px; height: 40px; border: 2px solid #233554;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.2rem; font-weight: bold; background: #1d2d44; transition: all 0.3s;
    }
    .cell.in-window { border-color: var(--primary); background: rgba(100, 255, 218, 0.1); }
    .cell.left-ptr { border-bottom: 4px solid var(--danger); }
    .cell.right-ptr { border-bottom: 4px solid var(--success); }

    .ptr-label { position: absolute; bottom: -30px; font-size: 0.8rem; font-weight: bold; }
    .ptr-l { color: var(--danger); }
    .ptr-r { color: var(--success); }

    /* ä»£ç¢¼å€ */
    .code-window { background: #011627; padding: 20px; border-radius: 8px; font-family: 'Consolas', monospace; font-size: 0.85rem; min-height: 380px; }
    .line { white-space: pre; border-left: 4px solid transparent; padding-left: 12px; color: #82aaff; margin: 1px 0; }
    .active-line { background: #1d3b53; border-left-color: var(--primary); color: #fff; }

    /* æ§åˆ¶éˆ• */
    .controls { text-align: center; margin-bottom: 20px; }
    input { background: var(--bg); border: 1px solid var(--accent); color: var(--primary); padding: 8px 15px; border-radius: 20px; outline: none; width: 180px; }
    button { background: var(--accent); border: none; color: white; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; margin: 0 5px; }
    
    .formula-box {
      font-family: monospace; background: rgba(241, 196, 15, 0.1); border: 1px solid var(--warning);
      padding: 10px; border-radius: 8px; margin-top: 15px; font-size: 0.9rem; text-align: center;
    }
  </style>
</head>
<body>

<div class="dashboard">
  <div class="card full-width">
    <h2>ğŸ“˜ 424. Longest Repeating Character Replacement</h2>
    <div class="info-section">
      <strong>é¡Œç›®æè¿°ï¼š</strong>çµ¦å®šå­—ä¸² <code>s</code> èˆ‡æ•´æ•¸ <code>k</code>ã€‚ä½ å¯ä»¥å°‡ä»»æ„å­—ç¬¦æ›¿æ›ç‚ºå¦ä¸€å€‹å¤§å¯«å­—ç¬¦ï¼Œæœ€å¤šæ“ä½œ <code>k</code> æ¬¡ã€‚æ±‚æ›¿æ›å¾Œã€Œé€£çºŒç›¸åŒå­—ç¬¦å­ä¸²ã€çš„æœ€å¤§é•·åº¦ã€‚<br>
      <strong>ç¯„ä¾‹ï¼š</strong><code>s = "AABABBA", k = 1</code> â” è¼¸å‡º <code>4</code> (å°‡ç´¢å¼• 2 çš„ B æ›æˆ Aï¼Œå¾—åˆ° "AAAA")ã€‚
    </div>
    
    <div class="status-panel">
      <div class="status-item"><span class="status-label">L / R Index</span><span id="stat-lr" class="status-value">0, 0</span></div>
      <div class="status-item"><span class="status-label">Max Frequency (maxf)</span><span id="stat-maxf" class="status-value">0</span></div>
      <div class="status-item"><span class="status-label">Window Size</span><span id="stat-win" class="status-value">0</span></div>
      <div class="status-item"><span class="status-label">Max Length (res)</span><span id="stat-res" class="status-value">0</span></div>
    </div>

    <div class="controls">
      S: <input type="text" id="sInput" value="AABABBA">
      K: <input type="number" id="kInput" value="1" style="width: 50px;">
      <button onclick="initSim()">é‡ç½®</button>
      <button id="stepBtn" onclick="step()">ä¸‹ä¸€æ­¥ (Step)</button>
    </div>

    <div class="formula-box" id="logicCheck">
      æª¢æ¸¬å…¬å¼ï¼š(Window Size) - (Max Frequency) â‰¤ K ï¼Ÿ
    </div>
  </div>

  <div class="card">
    <h3>ğŸ” æ»‘å‹•çª—å£è¦–è¦ºåŒ–</h3>
    <div class="window-visual" id="windowVisual"></div>
    <div id="countDisplay" style="text-align: center; font-family: monospace; color: var(--warning);">Count: {}</div>
    <div id="finalBox" style="text-align: center; color: var(--success); font-weight: bold; margin-top: 20px; display: none;"></div>
  </div>

  <div class="card">
    <div class="complexity-tag">æ™‚é–“: O(n)</div><div class="complexity-tag">ç©ºé–“: O(26) â‰ˆ O(1)</div>
    <div class="code-window" id="codeBox"></div>
  </div>
</div>

<script>
const codeLines = [
    "def characterReplacement(s, k):",
    "    count = {}",
    "    l, res, maxf = 0, 0, 0",
    "    for r in range(len(s)):",
    "        count[s[r]] = 1 + count.get(s[r], 0)",
    "        maxf = max(maxf, count[s[r]])",
    "        ",
    "        while (r - l + 1) - maxf > k:",
    "            count[s[l]] -= 1",
    "            l += 1",
    "            ",
    "        res = max(res, r - l + 1)",
    "    return res"
];

let s = "", k = 0, l = 0, r = 0, maxf = 0, res = 0, count = {};
let stepStage = 0; // 0: expand R, 1: update maxf, 2: check while, 3: update res

function initSim() {
    s = document.getElementById("sInput").value;
    k = parseInt(document.getElementById("kInput").value);
    l = 0; r = 0; maxf = 0; res = 0; count = {};
    stepStage = 0;
    document.getElementById("finalBox").style.display = "none";
    document.getElementById("stepBtn").disabled = false;
    renderCode();
    renderWindow();
    updateStatus();
}

function renderCode() {
    document.getElementById("codeBox").innerHTML = codeLines.map((line, i) => 
        `<div class="line" id="line-${i}">${line}</div>`).join("");
}

function renderWindow() {
    const visual = document.getElementById("windowVisual");
    visual.innerHTML = "";
    for (let i = 0; i < s.length; i++) {
        const container = document.createElement("div");
        container.className = "cell-container";
        
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.innerText = s[i];
        if (i >= l && i <= r) cell.classList.add("in-window");
        if (i === l) cell.classList.add("left-ptr");
        if (i === r) cell.classList.add("right-ptr");
        
        if (i === l) container.innerHTML += `<span class="ptr-label ptr-l" style="bottom:-25px">L</span>`;
        if (i === r) container.innerHTML += `<span class="ptr-label ptr-r" style="bottom:-45px">R</span>`;
        
        container.appendChild(cell);
        visual.appendChild(container);
    }
    document.getElementById("countDisplay").innerText = "Count: " + JSON.stringify(count);
}

function updateStatus() {
    const winSize = (r - l + 1);
    document.getElementById("stat-lr").innerText = `${l}, ${r}`;
    document.getElementById("stat-maxf").innerText = maxf;
    document.getElementById("stat-win").innerText = winSize;
    document.getElementById("stat-res").innerText = res;
    
    const check = (winSize - maxf);
    const logicBox = document.getElementById("logicCheck");
    logicBox.innerText = `æª¢æ¸¬ï¼š${winSize} (Size) - ${maxf} (MaxF) = ${check} (éœ€ â‰¤ ${k})`;
    logicBox.style.color = check > k ? "var(--danger)" : "var(--success)";
}

function step() {
    if (r >= s.length) return finish();
    clearHighlight();

    if (stepStage === 0) {
        highlight(4);
        count[s[r]] = 1 + (count[s[r]] || 0);
        stepStage = 1;
    } else if (stepStage === 1) {
        highlight(5);
        maxf = Math.max(maxf, count[s[r]]);
        stepStage = 2;
    } else if (stepStage === 2) {
        highlight(7);
        if ((r - l + 1) - maxf > k) {
            highlight(8); highlight(9);
            count[s[l]] -= 1;
            l++;
            // Stay in stage 2 to re-check while if necessary
        } else {
            stepStage = 3;
        }
    } else if (stepStage === 3) {
        highlight(11);
        res = Math.max(res, r - l + 1);
        r++;
        stepStage = 0;
    }
    
    renderWindow();
    updateStatus();
    if (r >= s.length && stepStage === 0) setTimeout(finish, 400);
}

function highlight(idx) { document.getElementById("line-"+idx)?.classList.add("active-line"); }
function clearHighlight() { document.querySelectorAll(".line").forEach(el => el.classList.remove("active-line")); }

function finish() {
    highlight(12);
    document.getElementById("stepBtn").disabled = true;
    const fb = document.getElementById("finalBox");
    fb.innerText = `âœ… æ¨¡æ“¬çµæŸï¼æœ€å¤§é•·åº¦ç‚º: ${res}`;
    fb.style.display = "block";
}

initSim();
</script>
</body>
</html>